<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="fastlane team">
  
  <title>Continuous Integration - fastlane docs</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/fabric.css" rel="stylesheet">
  <link href="../../css/fastlane.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Continuous Integration";
    var mkdocs_page_input_path = "best-practices/ContinuousIntegration.md";
    var mkdocs_page_url = "/best-practices/ContinuousIntegration/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-18658848-13', 'docs.fastlane.tools');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> fastlane docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
<li class="toctree-l1 ">
  <a class="" href="../..">Home</a>
  
</li>
<li>
          
            <li>
<ul class="subnav">
  <li><span>Getting Started</span></li>
  
  
<ul class="subnav">
  <li><span>Apple</span></li>
  
  
<li class="toctree-l1 ">
  <a class="" href="../../getting-started/apple/setup/">Setup</a>
  
</li>

  
  
<li class="toctree-l1 ">
  <a class="" href="../../getting-started/apple/screenshots/">Screenshots</a>
  
</li>

  
  
<li class="toctree-l1 ">
  <a class="" href="../../getting-started/apple/beta-deployment/">Beta Deployment</a>
  
</li>

  
  
<li class="toctree-l1 ">
  <a class="" href="../../getting-started/apple/appstore-deployment/">App Store Deployment</a>
  
</li>

  
</ul>

  
  
<ul class="subnav">
  <li><span>Android</span></li>
  
  
<li class="toctree-l1 ">
  <a class="" href="../../getting-started/android/setup/">Setup</a>
  
</li>

  
  
<li class="toctree-l1 ">
  <a class="" href="../../getting-started/android/screenshots/">Screenshots</a>
  
</li>

  
  
<li class="toctree-l1 ">
  <a class="" href="../../getting-started/android/deployment/">Deployment</a>
  
</li>

  
</ul>

  
</ul>
<li>
          
            <li>
<li class="toctree-l1 ">
  <a class="" href="../../actions/Actions/">Actions</a>
  
</li>
<li>
          
            <li>
<li class="toctree-l1 ">
  <a class="" href="../../FAQs/">FAQs</a>
  
</li>
<li>
          
            <li>
<ul class="subnav">
  <li><span>Codesigning</span></li>
  
  
<li class="toctree-l1 ">
  <a class="" href="../../codesigning/GettingStarted/">Getting Started</a>
  
</li>

  
  
<li class="toctree-l1 ">
  <a class="" href="../../codesigning/XcodeProject/">Xcode Project</a>
  
</li>

  
  
<li class="toctree-l1 ">
  <a class="" href="../../codesigning/Troubleshooting/">Troubleshooting</a>
  
</li>

  
</ul>
<li>
          
            <li>
<ul class="subnav">
  <li><span>Plugins</span></li>
  
  
<li class="toctree-l1 ">
  <a class="" href="../../plugins/AvailablePlugins/">AvailablePlugins</a>
  
</li>

  
  
<li class="toctree-l1 ">
  <a class="" href="../../plugins/CreatePlugin/">Create your own plugin</a>
  
</li>

  
  
<li class="toctree-l1 ">
  <a class="" href="../../plugins/PluginsTroubleshooting/">Plugins Troubleshooting</a>
  
</li>

  
</ul>
<li>
          
            <li>
<ul class="subnav">
  <li><span>Best Practices</span></li>
  
  
<li class="toctree-l1 ">
  <a class="" href="../Gitignore/">Gitignore</a>
  
</li>

  
  
<li class="toctree-l1 current">
  <a class="current" href="./">Continuous Integration</a>
  
  <ul>
    
      
    
      
      <li class="toctree-l3"><a href="#jenkins-integration">Jenkins Integration</a></li>
      
    
      
      <li class="toctree-l3"><a href="#circle-integration">Circle Integration</a></li>
      
    
      
      <li class="toctree-l3"><a href="#bamboo-integration">Bamboo Integration</a></li>
      
    
  </ul>
  
</li>

  
</ul>
<li>
          
            <li>
<li class="toctree-l1 ">
  <a class="" href="../../Advanced/">Advanced</a>
  
</li>
<li>
          
            <li>
<ul class="subnav">
  <li><span>Contributing</span></li>
  
  
<li class="toctree-l1 ">
  <a class="" href="../../contributing/UI/">UI</a>
  
</li>

  
  
<li class="toctree-l1 ">
  <a class="" href="../../contributing/CONTRIBUTING/">Contribution Guidelines</a>
  
</li>

  
</ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">fastlane docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Best Practices &raquo;</li>
        
      
    
    <li>Continuous Integration</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="continuous-integration"><a name="user-content-continuous-integration" href="#continuous-integration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Continuous Integration</h1>
<h1 id="jenkins-integration"><a name="user-content-jenkins-integration" href="#jenkins-integration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Jenkins Integration</h1>
<p>(or any other Continuous Integration system)</p>
<p>Deploying from your own computer isn't cool. You know what's cool? Letting a remote server publish app updates for you.</p>
<p><code>fastlane</code> automatically generates a JUnit report for you. This allows Continuous Integration systems, like <code>Jenkins</code>, access the results of your deployment.</p>
<h2 id="installation"><a name="user-content-installation" href="#installation" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Installation</h2>
<p>The recommended way to install <a href="http://jenkins-ci.org/">Jenkins</a> is through <a href="http://brew.sh/">homebrew</a>:</p>
<p><code>brew update &amp;&amp; brew install jenkins</code></p>
<p>From now on start <code>Jenkins</code> by running:</p>
<pre><code>jenkins
</code></pre>

<p>To store the password in the Keychain of your remote machine, I recommend running <code>sigh</code> or <code>deliver</code> using ssh or remote desktop at least once.</p>
<h2 id="deploy-strategy"><a name="user-content-deploy-strategy" href="#deploy-strategy" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Deploy Strategy</h2>
<p>You should <strong>not</strong> deploy a new App Store update after every commit, since you still have to wait 1-2 weeks for the review. Instead I recommend using Git Tags, or custom triggers to deploy a new update.</p>
<p>You can set up your own <code>Release</code> job, which is only triggered manually.</p>
<h2 id="plugins"><a name="user-content-plugins" href="#plugins" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Plugins</h2>
<p>I recommend the following plugins:</p>
<ul>
<li><strong><a href="https://wiki.jenkins-ci.org/display/JENKINS/HTML+Publisher+Plugin">HTML Publisher Plugin</a>:</strong> Can be used to show the generated screenshots right inside Jenkins.</li>
<li><strong><a href="https://wiki.jenkins-ci.org/display/JENKINS/AnsiColor+Plugin">AnsiColor Plugin</a>:</strong> Used to show the coloured output of the fastlane tools. Donâ€™t forget to enable <code>Color ANSI Console Output</code> in the <code>Build Environment</code> or your project.</li>
<li><strong><a href="https://wiki.jenkins-ci.org/display/JENKINS/Rebuild+Plugin">Rebuild Plugin</a>:</strong> This plugin will save you a lot of time.</li>
<li><strong><a href="https://wiki.jenkins-ci.org/display/JENKINS/Keychains+and+Provisioning+Profiles+Plugin">Keychains and Provisioning Profiles Plugin</a>:</strong> Manages keychains across Jenkins installations.</li>
</ul>
<h2 id="build-step"><a name="user-content-build-step" href="#build-step" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Build Step</h2>
<p>Use the following as your build step:</p>
<pre><code>fastlane appstore
</code></pre>

<p>Replace <code>appstore</code> with the lane you want to use.</p>
<h3 id="setup_jenkins"><a name="user-content-setup_jenkins" href="#setup_jenkins" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>setup_jenkins</h3>
<p>You can use <code>setup_jenkins</code> action which integrates well with the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Keychains+and+Provisioning+Profiles+Plugin">Keychains and Provisioning Profiles Plugin</a>. Selected keychain will automatically unlocked and the selected code signing identity will be used. Also all build results, like IPA files, archives, dSYMs and result bundles will be stored in the <code>./output</code> folder in the job workspace. In additions <code>setup_jenkins</code> will create separate derived data folder for each job (in the <code>./derivedData</code>).</p>
<p>Under the hood <code>setup_jenkins</code> configures other actions like: <code>gym</code>, <code>scan</code>, <code>xcodebuild</code>, <code>backup_xcarchive</code> and <code>clear_derived_data</code>.</p>
<h2 id="test-results-and-screenshots"><a name="user-content-test-results-and-screenshots" href="#test-results-and-screenshots" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Test Results and Screenshots</h2>
<p>To show the <strong>deployment result</strong> right in <code>Jenkins</code></p>
<ul>
<li><em>Add post-build action</em></li>
<li><em>Publish JUnit test result report</em></li>
<li><em>Test report XMLs</em>: <code>fastlane/report.xml</code></li>
</ul>
<p>To show the <strong>generated screenhots</strong> right in <code>Jenkins</code></p>
<ul>
<li><em>Add post-build action</em></li>
<li><em>Publish HTML reports</em></li>
<li><em>HTML directory to archive</em>: <code>fastlane/screenshots</code></li>
<li><em>Index page</em>: <code>screenshots.html</code></li>
</ul>
<p>Save and run. The result should look like this:</p>
<p><img alt="/img/best-practices/JenkinsIntegration.png" src="../../img/best-practices/JenkinsIntegration.png" /></p>
<h1 id="circle-integration"><a name="user-content-circle-integration" href="#circle-integration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Circle Integration</h1>
<p>To run fastlane on Circle as your CI, first create a <code>Gemfile</code> in the root of your project with the following content</p>
<pre><code class="ruby">source &quot;https://rubygems.org&quot;

gem &quot;fastlane&quot;
</code></pre>

<p>and run</p>
<pre><code>gem install bundler &amp;&amp; bundle update
</code></pre>

<p>This will create a <code>Gemfile.lock</code>, that defines all Ruby dependencies. Make sure to commit both files to version control.</p>
<p>Next, use the following <code>circle.yml</code> file</p>
<pre><code class="yml">machine:
  xcode:
    version: &quot;7.3&quot;
dependencies:
  override:
    - bundle check --path=vendor/bundle || bundle install --path=vendor/bundle --jobs=4 --retry=3 --without development
  cache_directories:
    - vendor/bundle
test:
  override:
    - bundle exec fastlane test
</code></pre>

<p>This will automatically cache the installed gems on Circle, making your CI builds much faster :rocket:</p>
<h1 id="bamboo-integration"><a name="user-content-bamboo-integration" href="#bamboo-integration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Bamboo Integration</h1>
<h2 id="repository-setup"><a name="user-content-repository-setup" href="#repository-setup" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Repository setup</h2>
<p>In bamboo under <strong>Linked Repositories</strong> (where you configure your git repo) under <strong>Advanced Settings</strong> is an option called <strong>Exclude changesets</strong></p>
<p>This dialog will allow you to enter a regular expression that if a commit matches, a build will not be triggered.  </p>
<p>For example, if your <code>Fastfile</code> is configured to make a commit message in the style of </p>
<pre><code>Build Version bump by fastlane to Version [0.3] Build [8]
</code></pre>

<p>Then you could use the following regex to ignore these commits</p>
<pre><code>^.*Build Version bump by fastlane.*$
</code></pre>

<h2 id="setting-repository-remote"><a name="user-content-setting-repository-remote" href="#setting-repository-remote" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Setting repository remote</h2>
<p>By default bamboo will do an anonymous shallow clone of the repo.  This will not preserve the  <code>git remote</code> information nor the list of tags.  If you are using bamboo to create commits you may want to use a code block similar to the following:</p>
<pre><code class="ruby"># In prep for eventually committing a version/build bump - set the git params
sh('git config user.name &quot;&lt;COMMITTER USERNAME&gt;&quot;')
sh('git config user.email &lt;COMITTER EMAIL&gt;')   

# Bamboo does an anonymous checkout so in order to update the build versions must set the git repo URL
git_remote_cmd = 'git remote set-url origin ' + ENV['bamboo_repository_git_repositoryUrl']
sh(git_remote_cmd) 
</code></pre>

<h2 id="speeding-up-build-times-with-carthage"><a name="user-content-speeding-up-build-times-with-carthage" href="#speeding-up-build-times-with-carthage" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Speeding up build times with carthage</h2>
<p>Carthage is a wonderful dependency manager but once you are start using a large number of frameworks, things can start to slow down, especially if your CI server has to run <code>carthage</code> EVERY time you check in a small line of code.</p>
<p>One way to make build times faster is to break your work up into two separate build plans (<em>this can get even more funky if you start having multiple branches</em>)</p>
<p>The general idea is to make a build plan: <strong>Project - Artifacts</strong> that builds the <code>Carthage</code> directory and stores it as a shared artifact.  Then you create a second build plan <strong>Project - Fastlane</strong> that pulls down the <code>Carthage</code> directory and runs <code>fastlane</code>.  </p>
<h3 id="artifact-plan"><a name="user-content-artifact-plan" href="#artifact-plan" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Artifact Plan</h3>
<p>Use a very simple setup to create this build plan.  First off you want to make sure this plan is manually triggered only - because you only need to run it whenever the <code>Cartfile</code> changes as opposed to after ever single commit.  It could also be on a nightly build perhaps if you desire.</p>
<h4 id="stages-jobs-tasks"><a name="user-content-stages-jobs-tasks" href="#stages-jobs-tasks" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Stages / Jobs / Tasks</h4>
<p>This plan consists of 1 Job, 1 Stage and 2 Tasks</p>
<ul>
<li>Task 1: <strong>Source Code Checkout</strong></li>
<li>Task 2: <strong>Script</strong> (<code>carthage update</code>)</li>
</ul>
<h4 id="artifact-definitions"><a name="user-content-artifact-definitions" href="#artifact-definitions" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Artifact definitions</h4>
<p>Create a shared artifact with the following info:</p>
<ul>
<li><strong>Name:</strong> CarthageFolder</li>
<li><strong>Location:</strong> (leave blank) </li>
<li><strong>Copy Pattern:</strong> Carthage/Build/** </li>
</ul>
<p><em>Optional</em>: You may want to automatically make the <strong>Fastlane Plan</strong> trigger whenever this plan is built</p>
<h3 id="fastlane-plan"><a name="user-content-fastlane-plan" href="#fastlane-plan" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Fastlane Plan</h3>
<p>When configuring fastlane to run in this setup you need to make sure that you are not calling either:</p>
<pre><code class="ruby">reset_git_repo(force: true)
</code></pre>

<p>or</p>
<pre><code class="ruby">ensure_git_status_clean
</code></pre>

<p>as these calls will either fail the build or delete the <code>Carthage</code> directory.  Additionally you want to remove any <code>carthage</code> tasks from inside your <code>Fastfile</code> as <code>carthage</code> is now happening externally to the build.</p>
<h4 id="build-plan-setup"><a name="user-content-build-plan-setup" href="#build-plan-setup" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Build plan setup</h4>
<p>What this build plan does is it checks out the source code, then it downloads the entire <code>Carthage/Build/</code> directory into your local project - which is exactly what would be created from <code>carthage bootstrap</code> and then it runs <code>fastlane</code></p>
<ul>
<li>Task 1: <strong>Source Code Checkout</strong></li>
<li>Task 2: <strong>Artifact Download</strong></li>
<li>Task 3: <strong>Fastlane</strong></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../Advanced/" class="btn btn-neutral float-right" title="Advanced">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Gitignore/" class="btn btn-neutral" title="Gitignore"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2016 <a href="https://fastlane.tools">fastlane</a></p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Gitignore/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../Advanced/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
